<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Products Page</title>
    <style>
        .card-img {
          height: 200px; /* Set a fixed height for the images */
          object-fit: cover; /* Maintain aspect ratio without stretching */
        }
    
    
        .navbar-brand img {
            height: 85px; /* Adjust the height of the logo */
        }
    
    
      </style>
</head>
<body>



    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">
          <img src="https://png.pngtree.com/png-clipart/20220213/original/pngtree-e-letter-logo-ecommerce-shop-store-design-png-image_7265997.png" alt="Store Logo">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item active">
              <a class="nav-link" href="http://127.0.0.1:5500/storeProducts.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="http://127.0.0.1:5500/shoppingCart.html">Shopping Cart</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="http://127.0.0.1:5500/signIn.html">Logout</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Profile</a>
            </li>
          </ul>
        </div>
      </nav>






    <div class="card-header">
        <h4 class="text-center text-primary" id="username">User Information</h4>
    </div>


<div class="container mt-5" id="productContainer">
    <!-- Product cards will be dynamically added here -->
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>

    var userEmail = sessionStorage.getItem("email");

    document.getElementById('username').innerText = "User Account: " + userEmail;


    // Make a request to the API endpoint to get the list of products
    axios.get('http://localhost:8080/demo3-1.0-SNAPSHOT/apiV1/products/all')
        .then((response) => {
            const products = response.data;
            renderProducts(products);
        })
        .catch((error) => {
            console.error('Error fetching products:', error);
        });

    // Function to render product cards dynamically
    function renderProducts(products) {
        const productContainer = document.getElementById('productContainer');

        let currentRow; // To keep track of the current row
        products.forEach((product, index) => {
            if (index % 3 === 0) {
                // Start a new row for every third product
                currentRow = document.createElement('div');
                currentRow.classList.add('row');
                productContainer.appendChild(currentRow);
            }

            const colDiv = document.createElement('div');
            colDiv.classList.add('col-md-4', 'mb-4');

            const cardDiv = document.createElement('div');
            cardDiv.classList.add('card');

            const img = document.createElement('img');
            img.src = product.imageAddr;
            img.classList.add('card-img-top');
            img.alt = `Product ${index + 1}`;

            const cardBody = document.createElement('div');
            cardBody.classList.add('card-body');

            const title = document.createElement('h5');
            title.classList.add('card-title');
            title.textContent = product.title;

            const description = document.createElement('p');
            description.classList.add('card-text');
            description.textContent = product.description;

            const price = document.createElement('p');
            price.classList.add('card-text');
            price.textContent = `Price: $${parseFloat(product.price).toFixed(2)}`;

            const addToCartBtn = document.createElement('button');
            addToCartBtn.classList.add('btn', 'btn-primary');
            addToCartBtn.textContent = 'Add to Cart';
            //---------------------------------------handling each product add to cart button---------------------------------------
            addToCartBtn.addEventListener('click', ()=>{
                // Retrieving a session storage item
                axios.post('http://localhost:8080/demo3-1.0-SNAPSHOT/apiV1/shopping-cart/add', {
            title: product.title,
            email: userEmail
            })
            .then((response) => {
            // Handle the response
                document.getElementById('username').textContent = response.data==1?"Product added successfully!":"products already exists!";
                setTimeout(()=>{
                    document.getElementById('username').innerText = "User Account: " + userEmail;
                },5000)
            })
            .catch((error) => {
            // Handle errors
                console.error('Error making POST request:', error);
            });
                //-------------------------------------------------------------------------------------------------------------------
            });

            // Append elements to the card
            cardBody.appendChild(title);
            cardBody.appendChild(description);
            cardBody.appendChild(price);
            cardBody.appendChild(addToCartBtn);

            cardDiv.appendChild(img);
            cardDiv.appendChild(cardBody);

            colDiv.appendChild(cardDiv);
            currentRow.appendChild(colDiv);
        });
    }
</script>

</body>
</html>
